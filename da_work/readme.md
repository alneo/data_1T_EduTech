# 1. Выборка из исходных данных

В целях формирования датасета для обучения моделей была создана выборка из исходных таблиц: `exercise_results_v2`, `activity_history_viewed_v2`, `schedule_v2`, `activities_guide_v2`, `users_v2`, `users_logs_v2`

<details>
<summary>Перечень имен полей, используемых в операторах SELECT, FROM, WHERE</summary>

Cодержится в документе [tables_columns.txt](./docs/tables_columns.txt)

| exercise_results_v2  | Тип использования |
|----------------------|-------------------|
| user_id              | select            |
| activity_id          | select, where     |
| created_at           | select            |
| result               | select            |
| success              | where             |


| activity_history_viewed_v2 | Тип использования |
|----------------------------|-------------------|
| user_id                    | select            |
| page_id                    | select            |
| activity_id                | select            |
| attestation                | select            |
| created_at                 | select            |
| page_type                  | where             |

| schedule_v2  | Тип использования                  |
|--------------|------------------------------------|
| course_id    | select                             |
| date_shown   | select                             |
| activivty_id | where - по этому ключу делаем join |
| type         | where                              |


| activities_guide_v2 | Тип использования                                  |
|---------------------|----------------------------------------------------|
| activity_id         | select, where - выводим поле и делаем по нему join |
| obyaz_priznak       | select                                             |
| att_priznak         | select                                             |

| users_v2    | Тип использования |
|-------------|-------------------|
| user_id     | select, where     |
| course_id   | select            |
| m2_progress | select            |

| users_logs_v2 | Тип использования |
|---------------|-------------------|
| user_id       | select            |
| comment       | where             |

</details>

# 2. Из выбранных данных формируем датасет для работы. 

Фильтруем пользователей по условиям обучения (исключительно онлайн), вводим и рассчитываем метрики. 

В итоговой выдаче отфильтровываем только те строки, в которых расчетный и реальный прогресс отличается не более чем на `10` баллов, очищая таким образом датасет от неполных или «битых» данных. 

Сформированный резалтсет представляет собой таблицу, которая в дальнейшем понадобится для анализа данных, для формирования датасета для обучения и тестирования моделей, а также для организации работы приложения.

Датасет содержит информацию о `5027` уникальных юзерах и для каждого юзера исследования на `212` дат, начиная с `2023-12-01` (начало обучения на курсе) по `2024-06-30` с интервалом в 1 день.

* Скрипт для сбора представлен в файле [main_dataset_sprint.sql](./docs/main_dataset_sprint.sql)
* Датасет в формате .csv находится в файле [main_dataset_sprint.csv](./docs/main_dataset_sprint.csv)
* Описание полей датасета представлено в файле [main_dataset_sprint_description.pdf](./docs/main_dataset_sprint_description.pdf)

# 3. Выборка для обучения модели

* Сделали выборку для обучения модели, которая прогнозирует прогресс и успешность окончания модуля пользователем с 1 по 10 неделю обучения.
* Скрипт для сбора датасета представлен в файле [20241125_for_model_study.sql](./docs/20241125_for_model_study.sql)
* Датасет в формате .csv находится в файле [20241125_sprint.csv](./docs/20241125_sprint.csv)
* Описание полей датасета представлено в файле [20241125_for_model_description.pdf](./docs/20241125_for_model_description.pdf)

# 4. Для работы модели в вебке видоизменили код для формирования данных для каждого отдельного юзера.

Скрипт представлен в файле [20241125_for_model_work_one_user_v2.sql](./docs/20241125_for_model_work_one_user_v2.sql)

# 5. Новые данные

Получили новые данные по «взрослым» курсам data. Для тестирования модели скорректировали скрипт [main_dataset_sprint.sql](./docs/main_dataset_sprint.sql):

Изменили имена исходных таблиц базы данных, откуда берутся исходные данные для сбора датасета. 

Имена таблиц соответствуют таблицам из пункта **1** с префиксом _v4.

Изменили подсчет успешности окончания курса в связи с новыми правилами расчета: 

* курс devops аттестован от 10 баллов, 
* остальные курсы – от 60 баллов. 

Не имеет значения прогресс по `М1` и `М2`.

Имеющиеся скрипты работают напрямую с номером курса, в связи с чем для проверки данных были вынуждены переименовать задублированный номер курса 77 на 770. 

В будущем необходимо осуществить привязку через другой уникальный идентификатор, которого в имеющихся у нас данных не было.

Согласно новым данным и их особенностям изменили имена двух полей:

|Было                 |Стало                |
|---------------------|---------------------|
|m2_progress          |real_course_progress |
|m2_success           |course_success       |

Скрипт сбора результирующей таблицы находится в файле [new_data.sql](./docs/new_data.sql)

# 6. Выборка для дообучения

На основе [new_data.sql](./docs/new_data.sql) сделали выборку для дообучения и тестирования моделей ИИ на новых данных (обучение на курсах data взрослых пользователей).

Датасет содержит `55` столбцов и `547` строк. Содержит информацию о 547 уникальных юзерах и для каждого из них подсчитаны показатели и данные на 10 недель, начиная с `2024-06-01` (начало обучения на курсе) с интервалом в 1 неделю. 

В датасете содержится изменение значений метрик в течение всего периода обучения.
Скрипт для сбора представлен в файле [20241128_new_data.sql](./docs/20241128_new_data.sql)

Датасет в формате .csv находится в файле [20241128_new_data.csv](./docs/20241128_new_data.csv)

Описание полей датасета представлено в файле [20241128_new_data_for_model_description.pdf](./docs/20241128_new_data_for_model_description.pdf)

# 7. Скрипт для получения датасета

Создаем скрипт для получения датасета по одному пользователю в новых данных (обучение на курсах data взрослых пользователей).

Скрипт представлен в файле [20241128_new_data_one_user.sql](./docs/20241128_new_data_one_user.sql)

# 8. Загрузка в базу данных

В базу данных загружена таблица `table_glu_dt_v3`, созданная на основе скрипта  [main_dataset_sprint.sql](./docs/main_dataset_sprint.sql). 

Что позволило оптимизировать время выполнения запросов и отображение графиков в вебке.


# 9. Скрипт для графиков

Создаем скрипт для графиков на главной странице приложения на основе таблицы `table_glu_dt_v3`:

* Динамика по статусам
* Среднее время на платформе
* Переходы между статусами

Скрипт представлен в файле [main_graph.sql](./docs/main_graph.sql)

# 10. Скрипт присваивания каждому юзеру статуса

Создаем скрипт для присваивания каждому юзеру статуса (`активный`, `засыпающий`, `спящий`) на основе алгоритмических расчетов. 

Скрипт сохранен в файле [status.sql](./docs/status.sql)

# 11. Скрипт для страницы Обучающиеся

Создаем скрипт для страницы Обучающиеся, который помогает определить Р(А)статус. 

В выдаче сравнивается статус на текущую дату, которую задает пользователь вебки и статус юзера неделю назад. 

В зависимости от тенденции присваивается значение `UP`, `NO_CHANGE`, `DOWN`. 

Скрипт находится в файле `users_status.txt`